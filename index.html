<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>强化模拟器</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>强化模拟器</h1>
            <p>作者oxking 版本1.1</p>
        </header>

        <main>
            <div class="controls">
                <button id="loadDataBtn" class="btn btn-primary">加载市场数据</button>
                <div id="loadingStatus" class="status hidden">正在加载数据...</div>
            </div>

            <div class="feature-tabs">
                <button id="customPriceTab" class="tab-btn">自定义价格</button>
                <button id="priceTab" class="tab-btn active">价格查询</button>
                <button id="enhanceTab" class="tab-btn">强化模拟器</button>
                <button id="rankingTab" class="tab-btn">排行榜</button>
            </div>

            <!-- 自定义价格配置功能 -->
            <div id="customPriceConfig" class="section hidden">
                <div class="custom-price-section">
                    <h2>自定义价格配置</h2>
                    <!-- 在自定义价格配置区域添加应用按钮 -->
                    <div class="config-management">
                        <div class="config-header">
                            <input type="text" id="customPriceConfigName" placeholder="配置文件名称">
                            <button id="saveCustomPriceConfig" class="btn btn-primary">保存配置</button>
                            <select id="customPriceConfigSelect">
                                <option value="">选择已保存的配置</option>
                            </select>
                            <button id="loadCustomPriceConfig" class="btn btn-secondary">加载配置</button>
                            <button id="deleteCustomPriceConfig" class="btn btn-danger">删除配置</button>
                            <button id="applyCustomPrices" class="btn btn-success">应用价格</button>
                            <button id="cancelCustomPrices" class="btn btn-warning">取消应用</button>
                        </div>
                    </div>
                    
                    <div class="custom-items">
                        <h3>自定义物品价格</h3>
                        <div class="custom-items-header">
                            <span>物品名称</span>
                            <span>等级</span>
                            <span>Ask价格</span>
                            <span>Bid价格</span>
                            <span>操作</span>
                        </div>
                        <div id="customItemsList"></div>
                        <button id="addCustomItem" class="btn btn-secondary">添加物品</button>
                    </div>
                </div>
            </div>

            <div id="itemSelection" class="section hidden">
                <h2>选择物品</h2>
                <div class="search-box">
                    <input type="text" id="itemSearch" placeholder="搜索物品名称...">
                </div>
                <div class="category-filter">
                    <button class="category-btn active" data-category="all">全部</button>
                    <button class="category-btn" data-category="weapons">武器</button>
                    <button class="category-btn" data-category="armor">防具</button>
                    <button class="category-btn" data-category="accessories">配饰</button>
                    <button class="category-btn" data-category="materials">材料</button>
                    <button class="category-btn" data-category="essences">精华</button>
                    <button class="category-btn" data-category="consumables">消耗品</button>
                    <button class="category-btn" data-category="enhancement">强化物品</button>
                    <button class="category-btn" data-category="others">其他</button>
                </div>
                <div id="itemList" class="item-grid"></div>
            </div>

            <div id="levelSelection" class="section hidden">
                <h2>选择强化等级</h2>
                <div id="levelButtons" class="level-grid"></div>
            </div>

            <div id="priceDisplay" class="section hidden">
                <h2>价格信息</h2>
                <div class="price-card">
                    <div class="item-info">
                        <h3 id="selectedItemName"></h3>
                        <p id="selectedLevel"></p>
                    </div>
                    <div class="price-info">
                        <div class="price-item">
                            <span class="price-label">Ask价格:</span>
                            <span id="askPrice" class="price-value"></span>
                        </div>
                        <div class="price-item">
                            <span class="price-label">Bid价格:</span>
                            <span id="bidPrice" class="price-value"></span>
                        </div>
                    </div>
                </div>
                <button id="backToItems" class="btn btn-secondary">返回物品选择</button>
            </div>

            <!-- 强化模拟器功能 -->
            <div id="enhanceSimulator" class="section hidden">
                <!-- 角色属性配置 -->
                <div class="enhance-section">
                    <h2>角色属性配置</h2>
                    <div class="character-config">
                        <div class="config-row">
                            <div class="config-item">
                                <label>人物等级:</label>
                                <input type="number" id="characterLevel" value="1" min="1" max="100">
                            </div>
                            <div class="config-item">
                                <label>天文台等级:</label>
                                <input type="number" id="observatoryLevel" value="0" min="0" max="10">
                            </div>
                        </div>
                        <div class="config-row">
                            <div class="config-item">
                                <label>强化茶:</label>
                                <input type="checkbox" id="enhancingTea">
                            </div>
                            <div class="config-item">
                                <label>超级强化茶:</label>
                                <input type="checkbox" id="superEnhancingTea">
                            </div>
                        </div>
                        <div class="config-row">
                            <div class="config-item">
                                <label>究极强化茶:</label>
                                <input type="checkbox" id="ultimateTea">
                            </div>
                            <div class="config-item">
                                <label>福气茶:</label>
                                <input type="checkbox" id="luckTea">
                            </div>
                        </div>
                        <div class="config-row">
                            <div class="config-item">
                                <label>强化师上衣速度(%):</label>
                                <input type="number" id="enhancerShirt" value="0" min="0" step="0.1">
                            </div>
                            <div class="config-item">
                                <label>强化师裤子速度(%):</label>
                                <input type="number" id="enhancerPants" value="0" min="0" step="0.1">
                            </div>
                        </div>
                        <div class="config-row">
                            <div class="config-item">
                                <label>强化手套速度(%):</label>
                                <input type="number" id="enhancerGloves" value="0" min="0" step="0.1">
                            </div>
                            <div class="config-item">
                                <label>速度项链速度(%):</label>
                                <input type="number" id="speedNecklace" value="0" min="0" step="0.1">
                            </div>
                        </div>
                        <div class="config-row">
                            <div class="config-item">
                                <label>饮料浓度(%):</label>
                                <input type="number" id="drinkConcentration" value="0" min="0" step="0.1">
                            </div>
                            <div class="config-item">
                                <label>强化器(%):</label>
                                <input type="number" id="enhancerBonus" value="0" min="0" step="0.1">
                            </div>
                        </div>
                        <div class="config-row">
                            <div class="config-item">
                                <label>社区BUFF(%):</label>
                                <input type="number" id="communityBuff" value="0" min="0" step="0.1">
                            </div>
                            <div class="config-item">
                                <!-- 空白项，保持布局对称 -->
                            </div>
                        </div>
                        <div class="config-row">
                            <div class="config-item">
                                <label>配置名称:</label>
                                <input type="text" id="configName" placeholder="输入配置名称">
                            </div>
                            <div class="config-item">
                                <select id="configSelect">
                                    <option value="">选择已保存的配置</option>
                                </select>
                            </div>
                        </div>
                        <div class="config-row">
                            <div class="config-item">
                                <button id="saveConfig" class="btn btn-primary">保存配置</button>
                            </div>
                            <div class="config-item">
                                <button id="loadConfig" class="btn btn-secondary">加载配置</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 强化配方管理 -->
                <div class="enhance-section">
                    <h2>强化配方管理</h2>
                    <div class="recipe-management">
                        <div class="recipe-header">
                            <input type="text" id="recipeName" placeholder="配方名称">
                            <button id="saveRecipe" class="btn btn-primary">保存配方</button>
                            <!-- 将select替换为容器 -->
                            <div id="recipeSelectContainer" class="recipe-select-container"></div>
                            <button id="loadRecipe" class="btn btn-secondary">加载配方</button>
                            <button id="deleteRecipe" class="btn btn-danger">删除配方</button>
                            <button id="exportConfigs" class="btn btn-success">导出配置</button>
                            <button id="importConfigs" class="btn btn-info">导入配置</button>
                        </div>
                        
                        <div class="recipe-config">
                            <div class="target-item">
                                <h3>强化物品</h3>
                                <div id="targetItemContainer"></div>
                                <div class="enhance-levels">
                                    <label>物品等级:</label>
                                    <input type="number" id="itemLevel" value="50" min="1" max="200">
                                    <label>目标等级:</label>
                                    <input type="number" id="targetLevel" value="1" min="1" max="20">
                                </div>
                            </div>
                            

                            
                            <div class="materials">
                                <h3>强化材料</h3>
                                <div class="materials-header">
                                    <span>材料名称</span>
                                    <span>数量</span>
                                    <span>单价</span>
                                    <span>操作</span>
                                </div>
                                <div id="materialsList"></div>
                                <button id="addMaterial" class="btn btn-secondary">添加材料</button>
                            </div>
                            
                            <div class="enhance-cost">
                                <label>强化费用:</label>
                                <input type="number" id="enhanceCost" value="0" min="0">
                            </div>
                            
                            <div class="protection">
                                <h3>保护道具</h3>
                                <div id="protectionItemContainer"></div>
                                <div id="protectionPriceDisplay" class="protection-price hidden">
                                    <div class="price-info">
                                        <div class="price-item">
                                            <span class="price-label">价格:</span>
                                            <span id="protectionAskPrice" class="price-value"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 加成后属性显示 -->
                <div class="enhance-section">
                    <h2>加成后属性</h2>
                    <div class="bonus-attributes">
                        <div class="attribute-item">
                            <span class="attribute-label">强化成功率：</span>
                            <span id="bonusSuccessRate" class="attribute-value">+0%</span>
                        </div>
                        <div class="attribute-item">
                            <span class="attribute-label">行动速度：</span>
                            <span id="bonusActionSpeed" class="attribute-value">+0%</span>
                        </div>
                        <div class="attribute-item">
                            <span class="attribute-label">强化等级：</span>
                            <span id="bonusEnhanceLevel" class="attribute-value">+0</span>
                        </div>
                        <div class="attribute-item">
                            <span class="attribute-label">福气：</span>
                            <span id="bonusLuck" class="attribute-value">+0%</span>
                        </div>
                    </div>
                </div>

                <!-- 模拟结果 -->
                <div class="enhance-section">
                    <h2>模拟结果</h2>
                    <div class="simulation-controls">
                        <button id="runSimulation" class="btn btn-primary">开始模拟</button>
                        <div class="price-type-selector">
                            <label for="enhancePriceType">价格类型:</label>
                            <select id="enhancePriceType" class="custom-select">
                                <option value="mixed">左买右卖</option>
                                <option value="ask">全部Ask价</option>
                                <option value="bid">全部Bid价</option>
                            </select>
                        </div>
                    </div>
                    <div id="simulationResults" class="results-panel hidden">
                        <div class="result-grid">
                            <div class="result-item">
                                <span class="result-label">工时费最高的保护等级:</span>
                                <span id="bestProtectionLevel" class="result-value"></span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">强化次数:</span>
                                <span id="enhanceAttempts" class="result-value"></span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">强化时间:</span>
                                <span id="enhanceTime" class="result-value"></span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">保护次数:</span>
                                <span id="protectionUses" class="result-value"></span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">总成本:</span>
                                <span id="totalCost" class="result-value"></span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">工时费:</span>
                                <span id="hourlyCost" class="result-value"></span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">初始物品价格:</span>
                                <span id="initialItemPrice" class="result-value"></span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">最终物品价格(税后):</span>
                                <span id="finalItemPrice" class="result-value"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 排行榜功能 -->
            <div id="recipeRanking" class="section hidden">
                <div class="ranking-header">
                    <h2>配方工时费排行榜</h2>
                    <p class="ranking-description">显示所有已保存配方的工时费排行，包括从+0到目标等级的详细数据</p>
                </div>
                
                <div class="ranking-controls">
                    <div class="ranking-main-controls">
                        <div class="ranking-control-group">
                            <label for="targetLevelSelect" class="level-select-label">目标等级</label>
                            <div class="level-control-wrapper">
                                <button id="decreaseLevel" class="level-btn-control">−</button>
                                <div class="custom-select-wrapper">
                                    <select id="targetLevelSelect" class="custom-level-select">
                                        <option value="2">+2</option>
                                        <option value="3">+3</option>
                                        <option value="4">+4</option>
                                        <option value="5">+5</option>
                                        <option value="6">+6</option>
                                        <option value="7">+7</option>
                                        <option value="8">+8</option>
                                        <option value="9">+9</option>
                                        <option value="10" selected>+10</option>
                                        <option value="11">+11</option>
                                        <option value="12">+12</option>
                                        <option value="13">+13</option>
                                        <option value="14">+14</option>
                                        <option value="15">+15</option>
                                        <option value="16">+16</option>
                                        <option value="17">+17</option>
                                        <option value="18">+18</option>
                                        <option value="19">+19</option>
                                        <option value="20">+20</option>
                                    </select>
                                    <div class="select-arrow-custom">▼</div>
                                </div>
                                <button id="increaseLevel" class="level-btn-control">+</button>
                            </div>
                        </div>
                        
                        <div class="ranking-control-group">
                            <label for="priceTypeSelect" class="level-select-label">价格类型</label>
                            <div class="custom-select-wrapper">
                                <select id="priceTypeSelect" class="custom-level-select">
                                    <option value="mixed" selected>左买右卖</option>
                                    <option value="ask">全部Ask价</option>
                                    <option value="bid">全部Bid价</option>
                                </select>
                                <div class="select-arrow-custom">▼</div>
                            </div>
                        </div>
                        
                        <div class="ranking-control-group">
                            <div class="ranking-stats" id="rankingStats" style="display: none;">
                                <span class="stats-text">共 <span id="totalRecipes" class="stats-number">0</span> 个配方</span>
                            </div>
                        </div>
                        
                        <div class="ranking-control-group">
                            <button id="generateRanking" class="btn btn-primary ranking-generate-btn">
                                <span class="btn-text">生成排行榜</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="rankingResults" class="ranking-results hidden">
                    <div class="ranking-export-controls">
                        <button id="exportRanking" class="btn btn-success">导出排行榜</button>
                    </div>
                    <div id="rankingTable"></div>
                </div>
            </div>
        </main>
    </div>

    <script src="math.min.js"></script>
    <script src="script.js"></script>
</body>
</html>